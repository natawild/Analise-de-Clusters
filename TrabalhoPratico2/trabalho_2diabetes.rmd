---
title: "National Institute of Diabetes and Digestive and Kidney Diseases"
author: "Grupo 4"
date: "29/11/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r}

#loira
#library(readr)
#diabetes <- read_csv("C:/Users/RP/Desktop/análise de #clusters/trabalho/diabetes.csv")
#View(diabetes)

#marcia
library(readr)
diabetes <- read_csv("C:/Users/marci.MARCIA.000/Downloads/diabetes.csv")
View(diabetes)

#samuel


```


# Descrição das variáveis envolvidas 

#### **Variável dependente**

Uma variável dependente é uma medida que dependerá do valor de outra(s) medida variável. Na base de dados apresentada, o resultado é considerada a variável binária dependente, uma vez que depende das restantes variáveis. Esta variável define se o paciente possuí ou não a doença diabetes. 

```{r var dependente }
#variável dependente 
resultado <- diabetes$Outcome

```

#### **Variáveis independentes** 

Uma variável indenpendente é uma medida que não depende de nenhuma outra medida, sendo que existem 8 variáveis deste tipo no modelo. 
Foram consideradas variáveis tais como o número de gravidezes, a concentração de glicose no plasma, a pressão sanguínea diastólica (mm Hg), a espessura da pele do trícepe (mm), o nível de insulina durante as 2 horas de teste (mu U/ml), o ´índice de massa corporal (peso (kg)/ altura (m)^2), a função de linhagem de diabetes e a idade em anos. 


```{r var independente }
#variáveis independentes 
gravidez <- diabetes$Pregnancies
glicose <- diabetes$Glucose
pressaosangue <- diabetes$BloodPressure
espessurapele <- diabetes$SkinThickness
insulina <- diabetes$Insulin
imc <- diabetes$BMI
funcaogenetica <- diabetes$DiabetesPedigreeFunction
idade <- diabetes$Age
```


```{r criacao fator }
#criação das variáveis como fator 
resultado.f <- factor(resultado)

levels(resultado)<-c("Não","Sim")

is.factor(resultado)

# número de vezes que cada variável aparece 
summary(resultado)

```

# Análise Descritiva  

Utilizando a função "summary" verificamos o mínimo, máximo, a mediana e os quartis para cada variável em estudo. 

```{r summary dos dados}
#summary dos dados 
summary(diabetes)
```


```{r plot nr pacientes}
table(resultado)

  resultado <- c(500, 268)
  bp <- barplot(resultado,
  main = "Número de pacientes com diabetes",
  ylab = "Número de pacientes",
  xlab = "Tem ou não diabetes",
  ylim = c(0,600),
  names.arg = c("0", "1"),
  col = c("darkgreen", "darkred"),
  col.main = "blue",
  horiz = FALSE)
text(bp,resultado+20,labels=as.character(resultado))



```



## Análise da variável "gravidez"

```{r gravide}
table(gravidez)

grav <- c(111, 135,103,75,68,57,50,45,38,28,24,11,9,10,2,1,1)
 b <- barplot(grav,
 main = "Gravidez",
 xlab = "Número de gravidezes",
 ylab = "Número de pacientes",
 ylim = c(0,150),
 names.arg = c(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,17),
 col = c("lightblue"),
 col.main="blue",
 horiz = FALSE)
text(b,grav+10,labels=as.character(grav))



boxplot(idade ~ resultado, main="Idade vs Resultado", xlab = "Ter ou não ter diabetes", ylab = "Idade do paciente", col.main="blue", col=(c("darkred", "darkgreen")))

library(ggplot2)

ggplot(diabetes, aes(x = gravidez, fill = resultado)) + geom_bar()

```




```{r matriz}

install.packages(corrplot)
library(corrplot)

matriz <- diabetes
res<- cor(matriz)

round(res,2)
corrplot(res, method = "color")

```


Agora precisamos verificar os valores omissos e verificar quantos valores exclusivos existem para cada variável
usando a função sapply() que aplica a função passada como argumento a cada coluna do dataframe.

```{r tratamento dados}

sapply(diabetes, function (x) sum(is.na(x)))

#saber se existem missing values
data<- subset(diabetes,select=c(1,2,3,4,5,6,7,8,9))
missmap(data, main = "Missing values vs observed")


```



```{r modelacao}

library(caret)

# Prep Training e Test



set.seed(100)
trainDataIndex <- createDataPartition(diabetes$Outcome, p=0.7, list = F) # 70% training data
train <- diabetes[trainDataIndex, ]
test <- diabetes[-trainDataIndex, ]



#Modelo
model <- glm(Outcome~.,family=binomial(link='logit'),data=train)
summary(model)

```


```{r}

anova(model, test="Chisq")

```

```{r}

fitted.results <- predict(model,newdata=subset(test,select=c(1,2,3,4,5,6,7,8,9)),type='response')
fitted.results <- ifelse(fitted.results > 0.5,1,0)
misClasificError <- mean(fitted.results != test$Outcome)
print(paste('Accuracy',1-misClasificError))

library(tidyverse)# for data manipulation

install.packages("dlstats")
library(dlstats)    # for package download stats

install.packages("pkgsearch")
library(pkgsearch)

install.packages("ROCR")
library(ROCR)

p <- predict(model, newdata=subset(test,select=c(1,2,3,4,5,6,7,8,9)), type="response")
pr <- prediction(p, test$Outcome)
prf <- performance(pr, measure = "tpr", x.measure = "fpr")
plot(prf)

```



```{r}
auc <- performance(pr, measure = "auc")
auc <- auc@y.values[[1]]
auc

```

```{r}
#validação interna
install.packages("yhat")
library(yhat)
pr_i <- prediction(yhat, train$Outcome)
prf_i <- performance(pr_i, measure = "tpr", x.measure = "fpr")
plot(prf_i)

```

















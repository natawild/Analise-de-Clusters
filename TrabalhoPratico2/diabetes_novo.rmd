---
title: "diabetes_novo"
author: "Ana Sofia"
date: "02/12/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Apresentação do caso de estudo 

Este data set foi extraido no Kaggle, mas originalmente foi retirado do Instituto Nacional de Diabetes e Doenças Digestivas e Renais dos Estados Unidos. O objetivo deste conjunto de dados seria prever se um paciente tem ou não diabetes, baseado em determinadas medidas de diagnóstico incluídas no data set. Neste conjunto de dados estão presentes pacientes do género feminino com pelo menos 21 anos de idade e origem da povoação indigena Pima. 

## Descrição dos dados 
O dataset contém informações de 768 mulheres, das quais 268 mulheres foram diagnosticadas com diabetes. As informações disponíveis incluem 8 variáveis, tais como Idade, Número de gestações, Glicose, Insulina, etc. Uma descrição mais detalhada sobre as variáveis está exposta nos pontos abaixo. A variável de resposta no conjunto de dados é um classificador binário, *Outcome*, que indica se a pessoa foi diagnosticada com diabetes ou não. 


* *Pregnancies*: Número de vezes que engravidou 
* *Glucose*: Concentração de glicose no plasma durante 2 horas presente num teste de tolerância à glicose por via oral
* *BloodPressure*: Pressão sanguínea diastólica (mm Hg)
* *SkinThickness*: Espessura da dobra da pele do tríceps (mm)
* *Insulin*: Insulina sérica de 2 horas ($niu$U/ml)
* BMI: índice de massa gorda (weight in kg/(height in m)2)
* *DiabetesPedigreeFunction*: Função de heretiedade do diabetes (uma função que pontua a probabilidade de diabetes com base no histórico familiar)
* *Age*: Idade (anos)
* *Outcome*: Variável de classe (0 se não diabético, 1 se diabético)
\beta

| Nome da variável         | Tipo de dados | Descrição da variável                                                               |
|--------------------------|---------------|-------------------------------------------------------------------------------------|
| Pregnancies              | integer       | Número de vezes que engravidou                                                      |
| Glucose                  | integer       | Concentração de glicose no plasma às 2 horas num teste oral de tolerância à glicose |
| BloodPressure            | integer       | Pressão sanguínea diastólica                                                        |
| SkinThickness            | integer       | Espessura da dobra da pele do tríceps                                               |
| Insulin                  | integer       | Insulina sérica de 2 horas (µU / ml)                                                |
| BMI                      | numeric       | índice de massa corporal                                                            |
| DiabetesPedigreeFunction | numeric       | Síntese da história do Diabetes Mellitus em familiares                              |
| Age                      | integer       | Idade (anos)                                                                        |
| Outcome                  | integer       | Ocorrência ou não da diabetes                                                       |

```{r}

#loira
#library(readr)
#diabetes <- read_csv("C:/Users/RP/Desktop/análise de clusters/TP2/diabetes.csv")
#View(diabetes)

#marcia
#library(readr)
#diabetes <- read_csv("C:/Users/marci.MARCIA.000/Downloads/diabetes.csv")
#View(diabetes)

#samuel

#celia 
library(readr)
diabetes <- read_csv("diabetes.csv")
View(diabetes)


```


# Descrição das variáveis envolvidas 

#### **Variável dependente**

Uma variável dependente é uma medida que dependerá do valor de outra(s) medida variável. Na base de dados apresentada, o resultado é considerada a variável binária dependente, uma vez que depende das restantes variáveis. Esta variável define se o paciente possuí ou não a doença diabetes. 

```{r var dependente }
#variável dependente 
resultado <- diabetes$Outcome
```


#### **Variáveis independentes** 

Uma variável independente é uma medida que não depende de nenhuma outra medida, sendo que existem 8 variáveis deste tipo no modelo. 
Foram consideradas variáveis tais como o número de gravidezes, a concentração de glicose no plasma, a pressão sanguínea diastólica (mm Hg), a espessura da pele do trícepe (mm), o nível de insulina durante as 2 horas de teste (mu U/ml), o ´índice de massa corporal (peso (kg)/ altura (m)^2), a função de linhagem de diabetes e a idade em anos. 


```{r var independente }
#variáveis independentes 
gravidez <- diabetes$Pregnancies
glicose <- diabetes$Glucose
pressaosangue <- diabetes$BloodPressure
espessurapele <- diabetes$SkinThickness
insulina <- diabetes$Insulin
imc <- diabetes$BMI
funcaogenetica <- diabetes$DiabetesPedigreeFunction
idade <- diabetes$Age
```


```{r criacao fator}
resultado.f <- factor(resultado)

levels(resultado) <- c("Não", "Sim")

is.factor(resultado)


summary(resultado)

```

# Análise Descritiva  

Utilizando a função "summary" verificamos o mínimo, máximo, a mediana e os quartis para cada variável em estudo. 

```{r summary dos dados}
#summary dos dados 
summary(diabetes)
```

```{r plot nr pacientes}
table(resultado)

resultado <- c(500, 268)
  bp <- barplot(resultado, main = "Número de pacientes com diabetes", ylab = "Número de pacientes", xlab = "Tem ou não diabetes", ylim = c(0,600), names.arg = c("0", "1"), col = c("darkgreen", "darkred"), col.main = "blue", horiz = FALSE)
text(bp,resultado+20,labels=as.character(resultado))
```


## Análise da variável "gravidez"

```{r gravide}
table(gravidez)

grav <- c(111, 135,103,75,68,57,50,45,38,28,24,11,9,10,2,1,1)
 b <- barplot(grav,
 main = "Gravidez",
 xlab = "Número de gravidezes",
 ylab = "Número de pacientes",
 ylim = c(0,150),
 names.arg = c(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,17),
 col = c("lightblue"),
 col.main="blue",
 horiz = FALSE)
text(b,grav+10,labels=as.character(grav))
```



```{r grafico samuel}

library(ggplot2)
ggplot(diabetes, aes(x = gravidez, fill = resultado.f)) + geom_bar()

```


## Matriz de correlação 

```{r matriz}

library(corrplot)

matriz <- diabetes
res<- cor(matriz)

round(res,2)
corrplot(res, method = "color")

```


Agora precisamos verificar os valores omissos e verificar quantos valores exclusivos existem para cada variável
usando a função sapply() que aplica a função passada como argumento a cada coluna do dataframe.

```{r tratamento dados}

library(Amelia)


sapply(diabetes, function (x) sum(is.na(x)))

#saber se existem missing values
data<- subset(diabetes,select=c(1,2,3,4,5,6,7,8,9))
missmap(data, main = "Missing values vs observed")


```




```{r modelacao}

library(caret)

# Prep Training e Test
set.seed(100)
trainDataIndex <- createDataPartition(diabetes$Outcome, p=0.7, list = F) # 70% training data
train <- diabetes[trainDataIndex, ]
test <- diabetes[-trainDataIndex, ]

#Modelo
model <- glm(Outcome~.,family=binomial(link='logit'),data=train)
summary(model)

```

```{r}
yhat=fitted.values(model)
```



```{r}

anova(model, test="Chisq")

```



```{r}

fitted.results <- predict(model,newdata=subset(test,select=c(1,2,3,4,5,6,7,8,9)),type='response')
fitted.results <- ifelse(fitted.results > 0.5,1,0)
misClasificError <- mean(fitted.results != test$Outcome)
print(paste('Accuracy',1-misClasificError))

library(tidyverse)# for data manipulation
library(dlstats)    # for package download stats
library(pkgsearch)
library(ROCR)

p <- predict(model, newdata=subset(test,select=c(1,2,3,4,5,6,7,8,9)), type="response")
pr <- prediction(p, test$Outcome)
prf <- performance(pr, measure = "tpr", x.measure = "fpr")
plot(prf)

```





```{r}
auc <- performance(pr, measure = "auc")
auc <- auc@y.values[[1]]
auc

```



```{r}
#validação interna
library(yhat)
pr_i <- prediction(yhat, train$Outcome)
prf_i <- performance(pr_i, measure = "tpr", x.measure = "fpr")
plot(prf_i)

```







